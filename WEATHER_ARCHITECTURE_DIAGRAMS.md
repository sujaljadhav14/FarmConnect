# ğŸŒ¤ï¸ Weather Feature - Architecture & Data Flow Diagrams

## System Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          FARMCONNECT WEATHER SYSTEM                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   FRONTEND (React)   â”‚         â”‚  BACKEND (Node.js)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      â”‚         â”‚                      â”‚
â”‚ WeatherPage.js â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º weatherRoutes.js   â”‚
â”‚ â”œâ”€ Location List    â”‚ HTTP    â”‚ â”œâ”€ GET/POST routes  â”‚
â”‚ â”œâ”€ Weather Display  â”‚ Requestsâ”‚ â”œâ”€ Auth Middleware  â”‚
â”‚ â”œâ”€ Forecasts       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º weatherControllerâ”‚
â”‚ â””â”€ Alerts          â”‚ JSON    â”‚ â”œâ”€ API Logic        â”‚
â”‚                      â”‚         â”‚ â””â”€ Database Calls   â”‚
â”‚ useWeatherSocket.js â”‚         â”‚                      â”‚
â”‚ â”œâ”€ Socket Connect   â”‚         â”‚ weatherSockets.js   â”‚
â”‚ â”œâ”€ Subscribe Alerts â”‚ Socket  â”‚ â”œâ”€ Real-time Eventsâ”‚
â”‚ â””â”€ Listen Events    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Broadcasting  â”‚
â”‚                      â”‚  .io   â”‚                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                          â”‚
                â”‚                          â”‚
                â–¼                          â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   localStorage   â”‚      â”‚    MongoDB       â”‚
        â”‚   (Caching)      â”‚      â”‚ â”œâ”€ Weather Data  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ â”œâ”€ User Prefs    â”‚
                                  â”‚ â””â”€ Alerts        â”‚
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                                          â–¼
                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                  â”‚ OpenWeatherMap   â”‚
                                  â”‚      API         â”‚
                                  â”‚ (Real-time Data) â”‚
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow Diagram - Adding New Location

```
User                Frontend              Backend             OpenWeatherMap
â”‚                      â”‚                    â”‚                      â”‚
â”œâ”€ Clicks "Add"â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º                   â”‚                      â”‚
â”‚                      â”‚                    â”‚                      â”‚
â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                      â”‚
â”‚                   â”‚ Show Form           â”‚ â”‚                      â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                      â”‚
â”‚                      â”‚                    â”‚                      â”‚
â”œâ”€ Enters Cityâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º                   â”‚                      â”‚
â”œâ”€ Clicks Submitâ”€â”€â”€â”€â”€â”€â”€â–º                   â”‚                      â”‚
â”‚                      â”‚                    â”‚                      â”‚
â”‚                      â”œâ”€ POST /weatherâ”€â”€â”€â”€â–ºâ”‚                      â”‚
â”‚                      â”‚  get-weather       â”‚                      â”‚
â”‚                      â”‚  { location }      â”‚                      â”‚
â”‚                      â”‚                    â”œâ”€ Validate JWT        â”‚
â”‚                      â”‚                    â”‚                      â”‚
â”‚                      â”‚                    â”œâ”€ Check Cache         â”‚
â”‚                      â”‚                    â”‚ (No? Fetch)          â”‚
â”‚                      â”‚                    â”‚                      â”‚
â”‚                      â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
â”‚                      â”‚                    â”‚ GET weather data     â”‚
â”‚                      â”‚                    â”‚ for location         â”‚
â”‚                      â”‚                    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      â”‚                    â”‚ Current + Forecast   â”‚
â”‚                      â”‚                    â”‚                      â”‚
â”‚                      â”‚                    â”œâ”€ generateAlerts()    â”‚
â”‚                      â”‚                    â”‚ Check thresholds     â”‚
â”‚                      â”‚                    â”‚                      â”‚
â”‚                      â”‚                    â”œâ”€ Save to MongoDB     â”‚
â”‚                      â”‚                    â”‚ Weather Collection   â”‚
â”‚                      â”‚                    â”‚                      â”‚
â”‚                      â”‚â—„â”€ 200 JSONâ”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚
â”‚                      â”‚ { weather }        â”‚                      â”‚
â”‚                      â”‚                    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚                      â”‚                    â”‚ â”‚ Socket.io Emit  â”‚ â”‚
â”‚                      â”‚                    â”‚ â”‚ weather-updated â”‚ â”‚
â”‚                      â”‚                    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                      â”‚                    â”‚                      â”‚
â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚                      â”‚
â”‚ Display Weather      â”‚                    â”‚                      â”‚
â”‚ Current + Forecast   â”‚                    â”‚                      â”‚
â”‚ Alerts               â”‚                    â”‚                      â”‚
â”‚                      â”‚                    â”‚                      â”‚
```

---

## Real-time Update Flow

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Weather Scheduler (Backend)    â”‚
                    â”‚ Runs every 30 minutes           â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ 1. Query MongoDB for outdated  â”‚
                    â”‚    weather locations            â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ 2. For each location:           â”‚
                    â”‚    - Call OpenWeatherMap API    â”‚
                    â”‚    - Process forecast data      â”‚
                    â”‚    - Generate alerts            â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ 3. Update MongoDB               â”‚
                    â”‚    - Save new weather data      â”‚
                    â”‚    - Update lastUpdated         â”‚
                    â”‚    - Store alerts               â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ 4. Emit Socket.io Event         â”‚
                    â”‚    io.to('weather-{userId}')   â”‚
                    â”‚    .emit('weather-updated',{}) â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                             â”‚
        â–¼                                             â–¼
   Connected Clients                        Alerts Channel
   (WeatherPage.js)                         (Alert Listeners)
   Listen & Update UI                       Show Alert
```

---

## Database Schema Relationship

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        USERS Collection                      â”‚
â”‚                                                               â”‚
â”‚  _id: ObjectId                                               â”‚
â”‚  name: String                                                â”‚
â”‚  email: String                                               â”‚
â”‚  phone: String                                               â”‚
â”‚  role: "farmer" â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚  ...                           â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚ Referenced as userId
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       WEATHER Collection                     â”‚
â”‚                                                               â”‚
â”‚  _id: ObjectId                                               â”‚
â”‚  userId: ObjectId (Foreign Key â†’ users._id)                 â”‚
â”‚  location: "Delhi"                                           â”‚
â”‚  latitude: 28.7041                                           â”‚
â”‚  longitude: 77.1025                                          â”‚
â”‚                                                               â”‚
â”‚  currentWeather: {                                           â”‚
â”‚    temperature: 25.5,                                        â”‚
â”‚    humidity: 60,                                             â”‚
â”‚    windSpeed: 5.2,                                           â”‚
â”‚    ...                                                       â”‚
â”‚  }                                                           â”‚
â”‚                                                               â”‚
â”‚  forecast: [                                                 â”‚
â”‚    { date, day, minTemp, maxTemp, ... },                    â”‚
â”‚    { ... }                                                   â”‚
â”‚  ]                                                           â”‚
â”‚                                                               â”‚
â”‚  hourlyForecast: [                                           â”‚
â”‚    { time, temperature, description, ... },                 â”‚
â”‚    { ... }                                                   â”‚
â”‚  ]                                                           â”‚
â”‚                                                               â”‚
â”‚  alerts: [                                                   â”‚
â”‚    { type, description, severity, timestamp },              â”‚
â”‚    { ... }                                                   â”‚
â”‚  ]                                                           â”‚
â”‚                                                               â”‚
â”‚  isFavorite: true                                            â”‚
â”‚  lastUpdated: ISODate("2024-01-15T10:30:00Z")               â”‚
â”‚  createdAt: ISODate("2024-01-10T10:00:00Z")                 â”‚
â”‚  updatedAt: ISODate("2024-01-15T10:30:00Z")                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## API Request/Response Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         POST /api/weather/get-weather                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚ REQUEST:                                                     â”‚
â”‚ {                                                            â”‚
â”‚   "location": "Delhi"                                        â”‚
â”‚ }                                                            â”‚
â”‚                                                               â”‚
â”‚ HEADERS:                                                     â”‚
â”‚ Authorization: Bearer jwt_token_here                         â”‚
â”‚                                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚ RESPONSE (Success - 200):                                    â”‚
â”‚ {                                                            â”‚
â”‚   "success": true,                                           â”‚
â”‚   "weather": {                                               â”‚
â”‚     "_id": "507f1f77bcf86cd799439011",                       â”‚
â”‚     "userId": "507f1f77bcf86cd799439010",                    â”‚
â”‚     "location": "Delhi",                                     â”‚
â”‚     "currentWeather": {                                      â”‚
â”‚       "temperature": 25.5,                                   â”‚
â”‚       "feelsLike": 24.3,                                     â”‚
â”‚       "humidity": 60,                                        â”‚
â”‚       "windSpeed": 5.2,                                      â”‚
â”‚       "description": "Clear sky",                            â”‚
â”‚       "icon": "01d"                                          â”‚
â”‚     },                                                       â”‚
â”‚     "forecast": [                                            â”‚
â”‚       {                                                      â”‚
â”‚         "date": "1/15/2024",                                 â”‚
â”‚         "day": "Mon",                                        â”‚
â”‚         "minTemp": 20,                                       â”‚
â”‚         "maxTemp": 28,                                       â”‚
â”‚         "description": "Sunny"                               â”‚
â”‚       }                                                      â”‚
â”‚     ],                                                       â”‚
â”‚     "alerts": [                                              â”‚
â”‚       {                                                      â”‚
â”‚         "type": "EXTREME_HEAT",                              â”‚
â”‚         "description": "High temp: 40Â°C",                    â”‚
â”‚         "severity": "high"                                   â”‚
â”‚       }                                                      â”‚
â”‚     ]                                                        â”‚
â”‚   }                                                          â”‚
â”‚ }                                                            â”‚
â”‚                                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚ RESPONSE (Error - 404):                                      â”‚
â”‚ {                                                            â”‚
â”‚   "success": false,                                          â”‚
â”‚   "message": "Location not found"                            â”‚
â”‚ }                                                            â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Socket.io Event Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Socket.io Event Communications                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤

EMISSION SIDE (Server to Client):

  weatherScheduler.js                WeatherPage.js
        â”‚                                  â”‚
        â”œâ”€ weatherScheduler runs           â”‚
        â”‚  every 30 minutes                â”‚
        â”‚                                  â”‚
        â”œâ”€ Updates weather data            â”‚
        â”‚                                  â”‚
        â”œâ”€ Calls:                          â”‚
        â”‚  emitWeatherUpdate(io,           â”‚
        â”‚    userId,                       â”‚
        â”‚    weatherData)                  â”‚
        â”‚                                  â”‚
        â”œâ”€ io.to('weather-{userId}')       â”‚
        â”‚    .emit('weather-updated', {    â”‚
        â”‚      weather,                    â”‚
        â”‚      timestamp                   â”‚
        â”‚    })                            â”‚
        â”‚                                  â”‚
        â”‚â—„â”€â”€â”€ Socket receives event â”€â”€â”€â”€â”€â”€â–ºâ”‚
        â”‚                                  â”‚
        â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                        â”‚ useWeatherSocket.js
        â”‚                        â”‚ hook listens for:
        â”‚                        â”‚ 'weather-updated'
        â”‚                        â”‚
        â”‚                        â”œâ”€ Updates state
        â”‚                        â”œâ”€ Re-renders UI
        â”‚                        â””â”€ Shows new data

SUBSCRIPTION SIDE (Client to Server):

  WeatherPage.js          Socket.io         weatherController.js
        â”‚                     â”‚                     â”‚
        â”œâ”€ User logs in       â”‚                     â”‚
        â”‚                     â”‚                     â”‚
        â”œâ”€ useWeatherSocket   â”‚                     â”‚
        â”‚  initializes        â”‚                     â”‚
        â”‚                     â”‚                     â”‚
        â”œâ”€ socket.emit(       â”‚                     â”‚
        â”‚  'subscribe-       â”‚                     â”‚
        â”‚   weather-alerts', â”‚                     â”‚
        â”‚  userId)           â”‚                     â”‚
        â”‚                    â”œâ”€ Join room:         â”‚
        â”‚                    â”‚ 'weather-alerts-   â”‚
        â”‚                    â”‚  {userId}'          â”‚
        â”‚                    â”‚                     â”‚
        â”‚â—„â”€â”€â”€ Now subscribed â”€â”€â”€â”€â”€â”€â”€â–º              â”‚
        â”‚     to alerts                            â”‚
        â”‚                                          â”‚
        â”‚     Any alert will be                    â”‚
        â”‚     received by this user
```

---

## Component Hierarchy

```
WeatherPage.js (Main Container)
â”‚
â”œâ”€ FarmerMenu (Sidebar)
â”‚  â””â”€ Navigation links
â”‚
â”œâ”€ Header Section
â”‚  â””â”€ Page title
â”‚
â”œâ”€ Alerts Display
â”‚  â”œâ”€ Conditional rendering (if alerts exist)
â”‚  â””â”€ Alert cards (alert.map())
â”‚
â”œâ”€ Add Location Form
â”‚  â”œâ”€ Input field
â”‚  â””â”€ Submit button
â”‚
â”œâ”€ Location Selector (Conditional)
â”‚  â”œâ”€ List group (location.map())
â”‚  â”‚  â”œâ”€ Weather icon
â”‚  â”‚  â”œâ”€ Location name
â”‚  â”‚  â”œâ”€ Current temperature
â”‚  â”‚  â””â”€ Favorite indicator
â”‚  â”‚
â”‚  â””â”€ Weather Details (if activeLocation selected)
â”‚     â”‚
â”‚     â”œâ”€ Current Weather Card
â”‚     â”‚  â”œâ”€ Temperature display (large)
â”‚     â”‚  â”œâ”€ Feels like temp
â”‚     â”‚  â”œâ”€ Weather description
â”‚     â”‚  â”œâ”€ Favorite button
â”‚     â”‚  â””â”€ Delete button
â”‚     â”‚
â”‚     â”œâ”€ Weather Metrics (4 boxes)
â”‚     â”‚  â”œâ”€ Humidity
â”‚     â”‚  â”œâ”€ Wind speed
â”‚     â”‚  â”œâ”€ Visibility
â”‚     â”‚  â””â”€ Pressure
â”‚     â”‚
â”‚     â”œâ”€ Hourly Forecast Section
â”‚     â”‚  â”œâ”€ Section title
â”‚     â”‚  â””â”€ Horizontal scroll container
â”‚     â”‚     â””â”€ Hour cards (map)
â”‚     â”‚        â”œâ”€ Time
â”‚     â”‚        â”œâ”€ Temperature
â”‚     â”‚        â”œâ”€ Weather icon
â”‚     â”‚        â””â”€ Rain chance
â”‚     â”‚
â”‚     â””â”€ 7-Day Forecast Table
â”‚        â”œâ”€ Table header
â”‚        â””â”€ Table rows (forecast.map())
â”‚           â”œâ”€ Day & date
â”‚           â”œâ”€ Weather icon
â”‚           â”œâ”€ High/Low temp
â”‚           â”œâ”€ Humidity
â”‚           â”œâ”€ Wind speed
â”‚           â””â”€ Rain chance
â”‚
â””â”€ Empty State
   â”œâ”€ Cloud icon
   â”œâ”€ Message
   â””â”€ "Add Location" button
```

---

## Error Handling Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          ERROR HANDLING CHAIN                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤

Frontend Action
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Try-Catch Block in Component                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                               â”‚
â”‚  try {                                        â”‚
â”‚    const { data } = await axios.post(...)    â”‚
â”‚    if (data.success) {                        â”‚
â”‚      // Update state                          â”‚
â”‚    } else {                                   â”‚
â”‚      toast.error(data.message)                â”‚
â”‚    }                                          â”‚
â”‚  } catch (error) {                            â”‚
â”‚    toast.error(error.response?.data?.message)â”‚
â”‚  }                                            â”‚
â”‚                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Backend Error Handling                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                               â”‚
â”‚  1. Input Validation                         â”‚
â”‚     â”œâ”€ Check required fields                â”‚
â”‚     â””â”€ Return 400 if missing                â”‚
â”‚                                               â”‚
â”‚  2. Authentication Check                     â”‚
â”‚     â”œâ”€ Verify JWT token                     â”‚
â”‚     â””â”€ Return 401 if invalid                â”‚
â”‚                                               â”‚
â”‚  3. Authorization Check                      â”‚
â”‚     â”œâ”€ Verify farmer role                   â”‚
â”‚     â””â”€ Return 403 if not farmer             â”‚
â”‚                                               â”‚
â”‚  4. API Call Error                           â”‚
â”‚     â”œâ”€ Try OpenWeatherMap API               â”‚
â”‚     â”œâ”€ Catch: Location not found            â”‚
â”‚     â””â”€ Return 404 with message              â”‚
â”‚                                               â”‚
â”‚  5. Database Error                           â”‚
â”‚     â”œâ”€ Try MongoDB operations               â”‚
â”‚     â”œâ”€ Catch: Connection error              â”‚
â”‚     â””â”€ Return 500 with error message        â”‚
â”‚                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Response to Frontend                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  {                                            â”‚
â”‚    success: false,                           â”‚
â”‚    message: "User-friendly error message"   â”‚
â”‚  }                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User Notification                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  toast.error(message)                        â”‚
â”‚  â”œâ”€ Display error message                   â”‚
â”‚  â”œâ”€ Red color                                â”‚
â”‚  â””â”€ Auto-dismiss in 3 seconds               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Performance Optimization Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User Requests Weather Data         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Check MongoDB Cache                â”‚
â”‚  (Is data < 30 mins old?)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚          â”‚
    â–¼(YES)    â–¼(NO)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Return  â”‚  â”‚ Call OpenWeatherMap API  â”‚
â”‚ Cached  â”‚  â”‚ Save to MongoDB          â”‚
â”‚ Data    â”‚  â”‚ Emit Socket.io update    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚              â”‚
    â”‚              â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Send Response to Frontend          â”‚
â”‚  (Fresh or Cached Data)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend Displays Weather          â”‚
â”‚  Updates UI with new data           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

BENEFITS:
âœ“ Reduced API calls (Save 66% calls)
âœ“ Faster response time
âœ“ Lower bandwidth usage
âœ“ Fewer rate limit hits
âœ“ Better user experience
```

---

## Deployment Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PRODUCTION SERVER                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              FRONTEND (React Build)              â”‚  â”‚
â”‚  â”‚  - Served via nginx/Apache                       â”‚  â”‚
â”‚  â”‚  - Static files (HTML, CSS, JS)                  â”‚  â”‚
â”‚  â”‚  - CORS enabled for API calls                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚       BACKEND (Node.js Express Server)           â”‚  â”‚
â”‚  â”‚  - Port 8080 (configurable)                      â”‚  â”‚
â”‚  â”‚  - weatherRoutes.js (API endpoints)              â”‚  â”‚
â”‚  â”‚  - weatherController.js (Logic)                  â”‚  â”‚
â”‚  â”‚  - Socket.io Server (Real-time)                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚       MONGODB DATABASE (Cloud/Local)            â”‚  â”‚
â”‚  â”‚  - Weather collection                            â”‚  â”‚
â”‚  â”‚  - User references                               â”‚  â”‚
â”‚  â”‚  - Indexes on userId                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚      NODE SCHEDULER (Cron Job)                  â”‚  â”‚
â”‚  â”‚  - Runs every 30 minutes                        â”‚  â”‚
â”‚  â”‚  - Updates all weather locations                â”‚  â”‚
â”‚  â”‚  - Emits Socket.io events                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ HTTPS
                   â”‚ Port 443
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              EXTERNAL APIs                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚    OpenWeatherMap API                           â”‚   â”‚
â”‚  â”‚    https://api.openweathermap.org/data/2.5      â”‚   â”‚
â”‚  â”‚    (Weather Data)                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

This comprehensive architecture ensures:
- âœ… Real-time weather updates
- âœ… Scalable performance
- âœ… Secure data handling
- âœ… Efficient resource usage
- âœ… User-friendly experience

